OK
[pkg, init]
==================
OK
[pkg, registry, add, --local, test-reg2, registry-ambiguous]
==================
// Ambiguous pkg1
==================
Aborted
[pkg, install, pkg1]
Error: Multiple packages found for 'pkg1'
==================
// Disambiguate by giving full URL.
==================
OK
[pkg, install, localhost:<[*PORT*]>/pkg/pkg1]
Warning: The latest version of package 'localhost:<[*PORT*]>/pkg/pkg1' has changed its name to 'pkg1'.
Package 'localhost:<[*PORT*]>/pkg/pkg1@1.0.0' installed with prefix 'localhost:<[*PORT*]>/pkg/pkg1'.
==================
// Ambiguous pkg2
==================
OK
[pkg, search, --verbose, pkg2]
pkg2:
  description: Ambiguous to pkg2. Prefixes URL. This is an invalid URL for testing.
  url: example.com/localhost:<[*PORT*]>/pkg/pkg2
  version: 1.0.0
  hash: <[*HASH*]>

pkg2:
  description: git-package 2
  url: localhost:<[*PORT*]>/pkg/pkg2
  version: 2.4.2
  hash: <[*HASH*]>

==================
// Disambiguate by giving full URL even though that's the suffix of the longer one.
==================
OK
[pkg, install, localhost:<[*PORT*]>/pkg/pkg2]
Warning: The latest version of package 'localhost:<[*PORT*]>/pkg/pkg2' has changed its name to 'pkg2'.
Package 'localhost:<[*PORT*]>/pkg/pkg2@2.4.2' installed with prefix 'localhost:<[*PORT*]>/pkg/pkg2'.
==================
// Ambiguous 'ambiguous'
==================
OK
[pkg, search, --verbose, ambiguous]
ambiguous:
  description: first of two packages that have long name that is equal
  url: localhost:<[*PORT*]>/a/b/c/d/ambiguous
  version: 3.1.2
  hash: <[*HASH*]>

ambiguous:
  description: second of two packages that have long name that is equal
  url: localhost:<[*PORT*]>/a2/b/c/d/ambiguous
  version: 3.1.2
  hash: <[*HASH*]>

pkg2:
  description: Ambiguous to pkg2. Prefixes URL. This is an invalid URL for testing.
  url: example.com/localhost:<[*PORT*]>/pkg/pkg2
  version: 1.0.0
  hash: <[*HASH*]>

==================
// Need to add more segments to disambiguate.
==================
Aborted
[pkg, install, b/c/d/ambiguous]
Error: Multiple packages found for 'b/c/d/ambiguous'
==================
// Will still yield an error (because we don't have the package),
==================
Aborted
[pkg, install, a/b/c/d/ambiguous]
Error: Failed to download package 'localhost:<[*PORT*]>/a/b/c/d/ambiguous@3.1.2': Invalid repository http://localhost:<[*PORT*]>/a/b/c/d/ambiguous, Not Found
